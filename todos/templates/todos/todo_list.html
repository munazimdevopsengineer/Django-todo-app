{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">My Todo List</h2>

<form method="get" class="row g-2 mb-3">
  <div class="col-md-4">
    <input type="text" name="search" value="{{ search_query }}" class="form-control" placeholder="Search tasks...">
  </div>
  <div class="col-md-3">
    <select name="category" class="form-select">
      <option value="">All Categories</option>
      {% for cat in categories %}
        <option value="{{ cat.id }}" {% if category_filter|stringformat:"s" == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <select name="priority" class="form-select">
      <option value="">All Priorities</option>
      <option value="H" {% if priority_filter == 'H' %}selected{% endif %}>High</option>
      <option value="M" {% if priority_filter == 'M' %}selected{% endif %}>Medium</option>
      <option value="L" {% if priority_filter == 'L' %}selected{% endif %}>Low</option>
    </select>
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary w-100">Filter</button>
  </div>
</form>

<table class="table table-striped table-bordered bg-white">
  <thead class="table-dark">
    <tr>
      <th>Title</th>
      <th>Priority</th>
      <th>Category</th>
      <th>Due Date</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for todo in todos %}
      <tr class="{% if todo.is_overdue %}table-danger{% elif todo.is_completed %}table-success{% endif %}">
        <td>{{ todo.title }}</td>
        <td>
          {% if todo.priority == 'H' %}
            <span class="badge bg-danger">High</span>
          {% elif todo.priority == 'M' %}
            <span class="badge bg-warning text-dark">Medium</span>
          {% else %}
            <span class="badge bg-success">Low</span>
          {% endif %}
        </td>
        <td>{{ todo.category }}</td>
        <td>
          {% if todo.due_date %}
            {{ todo.due_date }} {% if todo.is_overdue %}<span class="text-danger fw-bold">(Overdue)</span>{% endif %}
          {% else %} â€” {% endif %}
        </td>
        <td>
          {% if todo.is_completed %}
            <span class="badge bg-success">Completed</span>
          {% else %}
            <span class="badge bg-secondary">Pending</span>
          {% endif %}
        </td>
        <td>
          <a href="{% url 'todo_edit' todo.id %}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{% url 'todo_delete' todo.id %}" class="btn btn-sm btn-danger">Delete</a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6" class="text-center">No tasks found.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<div class="d-flex justify-content-between">
  {% if todos.has_previous %}
    <a href="?page={{ todos.previous_page_number }}" class="btn btn-outline-primary">Previous</a>
  {% endif %}
  <span>Page {{ todos.number }} of {{ todos.paginator.num_pages }}</span>
  {% if todos.has_next %}
    <a href="?page={{ todos.next_page_number }}" class="btn btn-outline-primary">Next</a>
  {% endif %}
</div>

<a href="{% url 'export_excel' %}" class="btn btn-info mb-3">Export Excel</a>




<a href="{% url 'todo_create' %}" class="btn btn-success mt-3">+ Add Task</a>
{% endblock %}
